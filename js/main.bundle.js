(()=>{"use strict";_.random;const e=_.shuffle,t="hidden",r="modal-open",s=document.body,n="error",c=e=>"Esc"===e||"Escape"===e,o=document.querySelector(".big-picture"),a=document.querySelector("#comment").content.querySelector(".social__comment"),l=o.querySelector(".big-picture__cancel"),i=o.querySelector(".social__comments"),d=o.querySelector(".comments-loader"),u=o.querySelector(".big-picture__img > img"),m=o.querySelector(".likes-count"),v=o.querySelector(".comments-count"),p=o.querySelector(".social__shown-comments-count"),y=o.querySelector(".social__caption"),f=document.querySelector("#picture").content.querySelector(".picture"),g=document.querySelector(".pictures"),h=e=>{const n=f.cloneNode(!0);return n.querySelector(".picture__img").src=e.url,n.querySelector(".picture__likes").textContent=e.likes,n.querySelector(".picture__comments").textContent=e.comments.length,n.addEventListener("click",n=>{n.preventDefault(),(e=>{const n=e.comments;let _=0;s.classList.add(r),u.src=e.url,m.textContent=e.likes,v.textContent=n.length,y.textContent=e.description,i.replaceChildren(),d.classList.remove(t);const f=()=>{const e=n.slice(_,_+5),r=document.createDocumentFragment();e.forEach(e=>{r.appendChild((e=>{const t=a.cloneNode(!0);return t.querySelector(".social__picture").src=e.avatar,t.querySelector(".social__picture").alt=e.name,t.querySelector(".social__text").textContent=e.message,t})(e))}),i.appendChild(r),_+=e.length,p.textContent=_,_>=n.length&&d.classList.add(t)},g=()=>{f()},h=()=>{o.classList.add(t),s.classList.remove(r),document.removeEventListener("keydown",L),l.removeEventListener("click",h),d.removeEventListener("click",g)};function L(e){c(e.key)&&h()}document.addEventListener("keydown",L),l.addEventListener("click",h),d.addEventListener("click",g),f(),o.classList.remove(t)})(e)}),n},L=e=>{const t=document.createDocumentFragment();for(let r=0;r<e.length;r++)t.appendChild(h(e[r]));g.appendChild(t)},S="visually-hidden",q={chrome:{start:1,step:.1,range:{min:0,max:1}},sepia:{start:1,step:.1,range:{min:0,max:1}},marvin:{start:100,step:1,range:{min:0,max:100}},phobos:{start:3,step:.1,range:{min:0,max:3}},heat:{start:3,step:.1,range:{min:0,max:3}}},E=document.querySelector(".img-upload__form"),k=E.querySelector(".text__hashtags"),C=E.querySelector(".text__description"),b=()=>{(()=>{const e=k.value.trim();if(k.setCustomValidity(""),!e)return;const t=e.split(/\s+/).filter(e=>""!==e),r=new Set;t.forEach(e=>{if(!e.startsWith("#"))return void k.setCustomValidity("хэш-тег начинается с символа # (решётка)");if(1===e.length)return void k.setCustomValidity("хеш-тег не может состоять только из одной решётки");if(!/^#[a-zA-zа-яА-ЯёЁ0-9]+$/.test(e))return void k.setCustomValidity("хеш-тег содержит недопустимые символы");if(e.length>20)return void k.setCustomValidity("максимальная длина одного хэш-тега 20 символов, включая решётку");const t=e.toLowerCase();r.has(t)?k.setCustomValidity("один и тот же хэш-тег не может быть использован дважды"):r.add(t)}),t.length>5&&k.setCustomValidity("нельзя указать больше пяти хэш-тегов"),k.reportValidity()})()},w=()=>{(()=>{const e=C.value.trim();C.setCustomValidity(""),e&&(e.length>140&&C.setCustomValidity("максимальная длина одного комментария 140 символов"),C.reportValidity())})()},x=(e,t,r)=>{const n=document.querySelector(`#${e}`).content.querySelector(`.${e}`).cloneNode(!0),o=n.querySelector(`.${e}__button`),a=document.createDocumentFragment(),l=()=>{n.remove(),document.removeEventListener("keydown",i)},i=e=>{c(e.key)&&l()};t&&(n.querySelector(`.${e}__title`).textContent=t),r&&(o.textContent=r),o.addEventListener("click",l),document.addEventListener("keydown",i),n.addEventListener("click",e=>{e.target===n&&l()}),a.appendChild(n),s.appendChild(a)},$={GET:"https://23.javascript.htmlacademy.pro/kekstagram/data",POST:"https://23.javascript.htmlacademy.pro/kekstagram"},V=e=>{if(e.ok)return e;const{statusText:t,status:r}=e;throw new Error(`${r} — ${t}`)},F=(e,t,r,s)=>{fetch($[r],{method:r,body:s}).then(V).then(e=>e.json()).then(t=>e(t)).catch(e=>t(e))},D=["jpg","jpeg","png"],U=document.querySelector(".img-upload__form"),j=U.querySelector(".img-upload__overlay"),T=U.querySelector("#upload-file"),A=j.querySelector(".img-upload__preview img"),H=j.querySelector(".img-upload__scale"),N=j.querySelector(".scale__control--value"),O=j.querySelector(".img-upload__effects"),z=j.querySelector(".effect-level__value");T.addEventListener("change",()=>{const e=T.files[0],o=e.name.toLowerCase(),a=j.querySelectorAll(".effects__preview");if(D.some(e=>o.endsWith(e))){const t=new FileReader;t.addEventListener("load",()=>{A.src=t.result,a.forEach(e=>{e.style.backgroundImage=`url(${t.result})`})}),t.readAsDataURL(e)}const l=j.querySelector(".img-upload__effect-level");l.classList.add("visually-hidden"),noUiSlider.create(l,{start:1,step:.1,connect:"lower",range:{min:0,max:1},format:{to:function(e){return e},from:function(e){return parseFloat(e)}}}),l.noUiSlider.on("update",(e,t)=>{const r=e[t];z.value=r,((e,t,r)=>{switch(t){case"none":return;case"chrome":r.style.filter=`grayscale(${e})`;break;case"sepia":r.style.filter=`sepia(${e})`;break;case"marvin":r.style.filter=`invert(${e}%)`;break;case"phobos":r.style.filter=`blur(${e}px)`;break;case"heat":r.style.filter=`brightness(${e})`}})(r,A.classList.value.replace("effects__preview--",""),A)});const i=j.querySelector("#upload-cancel"),d=()=>{A.style.transform="scale(1)",A.style.filter="",A.classList="",N.value="100%",T.value="",j.classList.add(t),s.classList.remove(r),l.noUiSlider.destroy(),i.removeEventListener("click",d),document.removeEventListener("keydown",u),m.removeScaleHandler(),v.removeEffectsHandler(),k.removeEventListener("input",b),C.removeEventListener("input",w)};i.addEventListener("click",d);const u=e=>{const t=j.querySelector(".text__hashtags"),r=j.querySelector(".text__description");t!==document.activeElement&&r!==document.activeElement&&c(e.key)&&d()};document.addEventListener("keydown",u);const m=((e,t,r)=>{const s=e=>{e.target.classList.contains("scale__control--smaller")?"25%"!==t.value&&(t.value=parseFloat(t.value)-25+"%",r.style.transform=`scale(${parseFloat(t.value)/100})`):e.target.classList.contains("scale__control--bigger")&&"100%"!==t.value&&(t.value=parseFloat(t.value)+25+"%",r.style.transform=`scale(${parseFloat(t.value)/100})`)};return e.addEventListener("click",s),{removeScaleHandler:()=>{e.removeEventListener("click",s)}}})(H,N,A),v=((e,t,r,s)=>{const n=e=>{const n=e.target.value;switch(n){case"none":s.classList.add(S),r.classList="",r.classList.add(`effects__preview--${n}`),r.style.filter="none";break;case"chrome":case"sepia":case"marvin":case"phobos":case"heat":(e=>{s.classList.remove(S),r.classList="",r.classList.add(`effects__preview--${e}`),s.noUiSlider.updateOptions(q[e]),t.value=s.noUiSlider.get()})(n)}};return e.addEventListener("change",n),{removeEffectsHandler:()=>{e.removeEventListener("change",n)}}})(O,z,A,l);k.addEventListener("input",b),C.addEventListener("input",w);const p=()=>{x(n)},y=()=>{x("success")},_=e=>{e.preventDefault();const t=new FormData(U);F(y,p,"POST",t),U.reset(),d(),U.removeEventListener("submit",_)};U.addEventListener("submit",_),j.classList.remove(t),s.classList.add(r)});const G="img-filters__button--active",P=document.querySelector(".img-filters"),R=P.querySelector(".img-filters__form"),W={"filter-random":t=>{L(e(t).slice(0,10))},"filter-discussed":e=>{L(e.slice().sort((e,t)=>t.comments.length-e.comments.length))},"filter-default":e=>{L(e)}};F(e=>{L(e),(e=>{P.classList.remove("img-filters--inactive");const t=_.debounce((e,t)=>{(()=>{const e=document.querySelectorAll(".picture");e&&e.forEach(e=>e.remove())})(),W[e](t)},500);R.addEventListener("click",r=>{const s=r.target;s.classList.contains("img-filters__button")&&((()=>{const e=R.children;for(const t of e)t.classList.remove(G)})(),s.classList.add(G),t(s.id,e))})})(e)},e=>{x(n,e,"Закрыть")},"GET")})();
//# sourceMappingURL=main.bundle.js.map